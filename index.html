
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Wesin&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Wesin">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Wesin's blog">
<meta property="og:url" content="http://wesin.github.io/index.html">
<meta property="og:site_name" content="Wesin's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wesin's blog">
<meta name="twitter:description">

    
    
    <link rel="icon" href="/img/cat.ico">
    
    
    <link rel="apple-touch-icon" href="/img/bigcat.png">
    <link rel="apple-touch-icon-precomposed" href="/img/bigcat.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/bigcat.png" alt="Wesin&#39;s blog" title="Wesin&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Wesin&#39;s blog">Wesin&#39;s blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:wesin.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/18/Python学习-实战篇/" title="Python学习-实战篇" itemprop="url">Python学习-实战篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2017-08-18T08:03:42.000Z" itemprop="datePublished"> 发表于 2017-08-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Web自动化测试方案"><a href="#Web自动化测试方案" class="headerlink" title="Web自动化测试方案"></a>Web自动化测试方案</h1><p>Python selenium phantomJS</p>
<p><a href="http://cuiqingcai.com/2599.html" target="_blank" rel="external">http://cuiqingcai.com/2599.html</a></p>
<h1 id="运维自动化"><a href="#运维自动化" class="headerlink" title="运维自动化"></a>运维自动化</h1><p>使用 Fabric3 自动化部署 Python3 项目</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/18/Python学习-实战篇/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/18/Python学习-实战篇/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/14/敏捷开发被忽视的UML/" title="敏捷开发被忽视的UML" itemprop="url">敏捷开发被忽视的UML</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2017-08-14T03:19:09.000Z" itemprop="datePublished"> 发表于 2017-08-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>混了两年开发，忽然又进入了PM的角色上，好久没有做过项目管理了，很多工作方法都忘了。这里回忆顺便做个记录。</p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>从上次跳槽进了一个创业公司，一个20来个人的小公司，万事从简，交流靠吼，需求靠说。人少了还好，和产品1v1的干也没什么大不了。不得不说，公司发展很快，短短两年，公司已经有150+的人马了。团队也变大了，然而产品的需求还是几句话的描述，再多加几个界面图，交互，场景纯靠描述。几个产品的对接更是一群产品在讲天书，路人完全不知道讲的什么鬼。心理默默想，图呢。</p>
<h1 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h1><p>UML：Unified Modeling Language(统一建模语言)<br>UML主要的就是画图，图有好几种。<br>可以按照需求画相应的图。</p>
<p>这边着重介绍几个图：</p>
<ul>
<li>用例</li>
<li>活动图</li>
<li>类图</li>
<li>时序图</li>
<li>(流程图)</li>
</ul>
<h2 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h2><p>用例图：从用户角度描述系统功能，并指各功能的操作者。</p>
<p><img src="../images/UML/approcase.png" alt="Image"></p>
<h2 id="活动图"><a href="#活动图" class="headerlink" title="活动图"></a>活动图</h2><p>活动图是UML用于对系统的动态行为建模的另一种常用工具，它描述活动的顺序，展现从一个活动到另一个活动的控制流。活动图在本质上是一种流程图。</p>
<p>它是UML中用于对系统动态活动建模的图形，反映系统中一个活动到另一个活动的流程，常常用于描述业务过程和并行处理过程。活动图中包括泳道、活动开始、活动结束、活动、对象、分支、消息等图形符号。</p>
<p>总的来说：活动图是描述多个角色间协同工作的流程图。</p>
<p>用门店采购对接多牛供应商流程画了个事例图。<br><img src="../images/UML/pospurchaseduoniu.png" alt="Screen shot"></p>
<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p>流程图：流程图并不属于UML的基本图形类型，但是是程序员入门必须的一种图。可以拿来简单明朗的显示代码逻辑。</p>
<p>门店微信支付流程图。<br><img src="../images/UML/pospay.png" alt="Screen shot"></p>
<h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><p>类图：一般用于程序员与程序员之间的对话。作用于描述复杂的设计模式、框架、架构、类关系等<br><img src="../images/UML/class.png" alt="Image"></p>
<h2 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h2><p>时序图：比较清晰的描述函数的运行流程。</p>
<p><img src="../images/UML/time.png" alt="Image"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/PM/">PM</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/UML/">UML</a><a href="/tags/PM/">PM</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/14/敏捷开发被忽视的UML/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/14/敏捷开发被忽视的UML/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/12/Python学习-方法篇/" title="Python学习-方法篇" itemprop="url">Python学习-方法篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2017-08-12T03:04:28.000Z" itemprop="datePublished"> 发表于 2017-08-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="初始化篇"><a href="#初始化篇" class="headerlink" title="初始化篇"></a>初始化篇</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>mac本身自带了python版本，but是python2.x版本，如果有强迫症喜欢使用最新版本的可以安装python3。我这边安装在了/usr/local/bin,这个一般是在脚本文件第一行声明，表示使用python版本。</p>
<pre><code>#!/usr/local/bin/python3
</code></pre><h2 id="设置可执行的脚本权限"><a href="#设置可执行的脚本权限" class="headerlink" title="设置可执行的脚本权限"></a>设置可执行的脚本权限</h2><pre><code>chmod +x xxxx.py
</code></pre><h2 id="pip安装对应的python版本依赖库"><a href="#pip安装对应的python版本依赖库" class="headerlink" title="pip安装对应的python版本依赖库"></a>pip安装对应的python版本依赖库</h2><pre><code>sudo python3 -m pip install **
</code></pre><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>推荐：    Visual Studio Code </p>
<h1 id="语法学习"><a href="#语法学习" class="headerlink" title="语法学习"></a>语法学习</h1><p>随便挑几个语法python3语法网站学习<br><a href="http://www.web3.xin/python3/107.html" target="_blank" rel="external">http://www.web3.xin/python3/107.html</a><br><a href="http://www.runoob.com/python/python-pass-statement.html" target="_blank" rel="external">http://www.runoob.com/python/python-pass-statement.html</a></p>
<p>进阶可以阅读下<br><strong>Python进阶</strong>: <a href="https://github.com/eastlakeside/interpy-zh" target="_blank" rel="external">https://github.com/eastlakeside/interpy-zh</a></p>
<h1 id="方法篇"><a href="#方法篇" class="headerlink" title="方法篇"></a>方法篇</h1><p>使用过sublime和vscode来学习和编程python，对于语法的智能提示和高亮都挺差的，so相对于java、c#、swift这种语法严谨的语言来说，编写体验极差，对新手非常不友好，经常写着写着要去翻词典。</p>
<p>所以新手阶段免不得多练多写了。</p>
<h3 id="查看对象方法"><a href="#查看对象方法" class="headerlink" title="查看对象方法"></a>查看对象方法</h3><pre><code>&gt;&gt;&gt; a 
[1, 2, 3, 4, 4, 7]
&gt;&gt;&gt; dir(a)
[&apos;__add__&apos;, &apos;__class__&apos;, &apos;__contains__&apos;, &apos;__delattr__&apos;, &apos;__delitem__&apos;, &apos;__dir__&apos;, &apos;__doc__&apos;, &apos;__eq__&apos;, &apos;__format__&apos;, &apos;__ge__&apos;, &apos;__getattribute__&apos;, &apos;__getitem__&apos;, &apos;__gt__&apos;, &apos;__hash__&apos;, &apos;__iadd__&apos;, &apos;__imul__&apos;, &apos;__init__&apos;, &apos;__init_subclass__&apos;, &apos;__iter__&apos;, &apos;__le__&apos;, &apos;__len__&apos;, &apos;__lt__&apos;, &apos;__mul__&apos;, &apos;__ne__&apos;, &apos;__new__&apos;, &apos;__reduce__&apos;, &apos;__reduce_ex__&apos;, &apos;__repr__&apos;, &apos;__reversed__&apos;, &apos;__rmul__&apos;, &apos;__setattr__&apos;, &apos;__setitem__&apos;, &apos;__sizeof__&apos;, &apos;__str__&apos;, &apos;__subclasshook__&apos;, &apos;append&apos;, &apos;clear&apos;, &apos;copy&apos;, &apos;count&apos;, &apos;extend&apos;, &apos;index&apos;, &apos;insert&apos;, &apos;pop&apos;, &apos;remove&apos;, &apos;reverse&apos;, &apos;sort&apos;]
</code></pre><h3 id="查看方法使用"><a href="#查看方法使用" class="headerlink" title="查看方法使用"></a>查看方法使用</h3><pre><code>help(a)
</code></pre><p>也可以help某个方法</p>
<pre><code>help(a.count)
</code></pre><h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>例如 len(array)来获取列表长度这种，习惯了array.count无脑写法的，表示心累。</p>
<p><a href="http://www.runoob.com/python/python-built-in-functions.html" target="_blank" rel="external">http://www.runoob.com/python/python-built-in-functions.html</a></p>
<h1 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h1><p>定位脚本性能瓶颈</p>
<pre><code>python -m cProfile my_script.py
</code></pre><p>csv转json</p>
<pre><code>python -c &quot;import csv,json;print json.dumps(list(csv.reader(open(&apos;csv_file.csv&apos;))))
</code></pre><p>yield 接收输入</p>
<pre><code>def grep(pattern):
    print(&quot;Searching for&quot;, pattern)
    while True:
        line = (yield)
        if pattern in line:
            print(line)

search = grep(&apos;coroutine&apos;)
next(search)
#output: Searching for coroutine
search.send(&quot;I love you&quot;)
search.send(&quot;Don&apos;t you love me?&quot;)
search.send(&quot;I love coroutine instead!&quot;)
#output: I love coroutine instead!
</code></pre><p>读取文件数据</p>
<pre><code>import io

with open(&apos;photo.jpg&apos;, &apos;rb&apos;) as inf:
    jpgdata = inf.read()
</code></pre><ul>
<li>如果你想读取文件，传入r</li>
<li>如果你想读取并写入文件，传入r+</li>
<li>如果你想覆盖写入文件，传入w</li>
<li>如果你想在文件末尾附加内容，传入a</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>配置好环境，浏览下语法，掌握了方法，应该就可以开搞了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/12/Python学习-方法篇/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/12/Python学习-方法篇/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/12/Python学习-语法篇/" title="Python学习-语法篇" itemprop="url">Python学习-语法篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2017-08-12T03:03:50.000Z" itemprop="datePublished"> 发表于 2017-08-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="引用类型和值类型"><a href="#引用类型和值类型" class="headerlink" title="引用类型和值类型"></a>引用类型和值类型</h2><ul>
<li><p>踩坑版之从Swift过来操作数组</p>
<pre><code>var a = [1, 2, 4]
var b = a
b += [9]
a
b
</code></pre></li>
</ul>
<ul>
<li><p>永远不要定义可变类型的参数    </p>
<pre><code>&gt;&gt;&gt; def add_to(num, target=[]):
...     target.append(num)
...     return target
... 
&gt;&gt;&gt; add_to(1)
[1]
&gt;&gt;&gt; add_to(2)
[1, 2]
</code></pre></li>
</ul>
<h2 id="内置函数之语法糖"><a href="#内置函数之语法糖" class="headerlink" title="内置函数之语法糖"></a>内置函数之语法糖</h2><ul>
<li><p>列表生成式</p>
<pre><code>[x for x in range(5) if x % 2 == 0]
</code></pre></li>
<li><p>map, filter, reduce</p>
<pre><code>list(map(lambda x:x*2, range(5)))
list(filter(lambda x:x &gt; 3, range(5)))
</code></pre></li>
<li><p>sorted</p>
<pre><code>&gt;&gt;&gt; L = [(&apos;Bob&apos;, 75), (&apos;Adam&apos;, 92), (&apos;Bart&apos;, 66), (&apos;Lisa&apos;, 88)]
&gt;&gt;&gt; def by_name(t):
...     return t[0].lower()
... 
&gt;&gt;&gt; l1 = sorted(L, key=by_name)
&gt;&gt;&gt; l1
[(&apos;Adam&apos;, 92), (&apos;Bart&apos;, 66), (&apos;Bob&apos;, 75), (&apos;Lisa&apos;, 88)]
</code></pre></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/12/Python学习-语法篇/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/12/Python学习-语法篇/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/01/18/IOS蓝牙外设使用兼AppStore审核记/" title="IOS蓝牙外设使用兼AppStore审核记" itemprop="url">IOS蓝牙外设使用兼AppStore审核记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2017-01-18T06:27:20.000Z" itemprop="datePublished"> 发表于 2017-01-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>:打印，又是打印，销售不知道哪里找来个打印机要支持。好吧，不是所有的蓝牙打印机都是可以用corebluetooth去连接的。这次是Bixolon，spp型号的打印机。网上一搜，是个韩国的打印机。中国连官方代理也没有，只有淘宝有个买家，自称代理。这种打印机用的是苹果MFI认证的连接方式。免不得要适配下，废话不多说，献上教程。</p>
<h1 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h1><blockquote>
<ul>
<li>Build Phases 中添加ExternalAccessory.framework</li>
<li>Capabilities<br>   1.启用background modes 勾选External accessory communication、 Uses Bluetooth LE accessories、Acts as a Bluetooth LE accessory<br>  2.启用Wireless Accessory Configuration</li>
<li>info.plist添加Supported external accessory protocols<br><img src="../images/xcode8/info-external.png" alt="Screen shot"></li>
</ul>
</blockquote>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>一般调用对应的sdk即可，用corebluetooth的寻找打印机是找不到的。</p>
<h1 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h1><blockquote>
<ul>
<li>手机or pad蓝牙设置中先连接打印机。一般要输pin码。bixolon的pin码默认是0000</li>
<li>连接好打印机后再去代码中调用sdk查找打印机，方能找到打印机。然后对应发指令即可。ps:网上有不需要sdk也可以连接打印机。没尝试过，代码略多</li>
</ul>
</blockquote>
<h1 id="App审核"><a href="#App审核" class="headerlink" title="App审核"></a>App审核</h1><p>很关键，使用MFI认证的连接方式是必须要从厂家获取PPID的。这个流程一般是这样的。跟厂家沟通，厂家一般会发你一个表格可以填，需要的内容app名称、版本号、bundleid等。然后厂家拿这个去苹果申请把bundleid添加到他们的ppid里面。然后把ppid告诉我们。我们放到itunes里面的remark中备注好即可。一般如果已经审核被拒绝了，放上去之后最好在拒绝后面回复下已经放入备注中，不然人家也不会注意看，分分钟又拒绝了。在下已然有这样的经历。<br>这里大致贴下拒绝信息：<br>—– MFi - PPID —–</p>
<p>We have started your app review but are unable to complete the review because we cannot locate the MFi Product Plan ID (PPID) of the hardware accessory associated with your app.</p>
<p>If you do not know the PPID, please contact the accessory manufacturer for this information. Once you have the PPID, please enter this information in the Notes section for your app in iTunes Connect.</p>
<p>To edit the Notes section:</p>
<ul>
<li>Log in to iTunes Connect</li>
<li>Click on “My Apps”</li>
<li>Select your app</li>
<li>Scroll down to “App Review Information”</li>
<li>Update “Notes”</li>
<li>Click Save</li>
<li>Click Submit for Review</li>
</ul>
<p>Once you’ve updated the Notes section with the PPID, we can proceed with your app review. </p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Swift3/">Swift3</a><a href="/tags/Xcode8/">Xcode8</a><a href="/tags/Bluetooth/">Bluetooth</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/01/18/IOS蓝牙外设使用兼AppStore审核记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/01/18/IOS蓝牙外设使用兼AppStore审核记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/11/07/Swift3踩坑记/" title="Swift3踩坑记" itemprop="url">Swift3踩坑记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2016-11-07T01:37:19.000Z" itemprop="datePublished"> 发表于 2016-11-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>:Xcode8出来两个星期，手贱忍不住升级了，抱着对swift3强烈的期望升级了，升级了，升级，升……然后雪崩一场。</p>
<h1 id="Xcode8打开永远崩溃"><a href="#Xcode8打开永远崩溃" class="headerlink" title="Xcode8打开永远崩溃"></a><strong>Xcode8打开永远崩溃</strong></h1><p>刚升级的xcode8每次打开输入第一个字符就崩溃，一直如此从来没有改变。错误信息显示imagenamed插件问题，菜单栏并没有插件显示，强行自我淡定了下，在xcode插件目录找到了残留的插件尸体。<br>~/Library/Application Support/Developer/Shared/Xcode/Plug-ins<br>删除后终于能正常打开了。</p>
<h1 id="编译卡住不动了"><a href="#编译卡住不动了" class="headerlink" title="编译卡住不动了"></a><strong>编译卡住不动了</strong></h1><p>好醉，说好的优化了性能呢，代码转换后各种错误，然后编译找错误提示，再编译再来一批，打完N波僵尸后，系统编译到某个文件卡住永远不动了，关键是也不报错。听着笔记本可怜的轰隆隆声，心好碎。</p>
<p>网上找了N多资料，终于发现蛛丝马迹。</p>
<p>网上有说再以前的版本，有遇到xml字符串太长造成编译卡住问题。<br>仔细研究代码发现，原来是一个fmdb的sql语句问题，字段太多，insert语句太长，然后xcode就卡住了，卡住了，卡住，了……一口老血。</p>
<p>解决方法，不能使用fmdb自带的update方法，因为赋值参数太多了，会卡住，所以只能拼装成一个完整的sql，然后把老长老长的sql用StringBuilder包装起来，分割成无数份。</p>
<p>好吧，终于编译通过了。</p>
<h1 id="Swift3优化不完整的代码bug"><a href="#Swift3优化不完整的代码bug" class="headerlink" title="Swift3优化不完整的代码bug"></a><strong>Swift3优化不完整的代码bug</strong></h1><p>UITableView在ios开发中使用频率应该是很高的，swift3对UITableView的几个代理方法做了写法上的优化，比如</p>
<pre><code>func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell
</code></pre><p>原来的写法cellForRowAt对应的是cellForRowAtIndexPath，少了多余的IndexPath，完美，看起来简化多了。批量替换下呗。</p>
<p>编译好后一看高度什么鬼，点击为什么没效果。然而编译也没报错。还原回去才发现 didSelectRowAtIndexPath 在xcode8中后面的IndexPath必须有，没有这个代理就不会被调用。也是吐血一升。</p>
<h1 id="Swift3-extension的坑"><a href="#Swift3-extension的坑" class="headerlink" title="Swift3 extension的坑"></a><strong>Swift3 extension的坑</strong></h1><p>我不知道extension文档里面有没有说过不能放override的方法，不然这个方法在release下面是不会被调用的。然而为什么在debug模式下override的方法又会被调用。这个只能说坑到家了。好不容易把代码打包半天提交到Itunesconnect, testflight下来一看剧情不一样。</p>
<p>🐱了个咪，为什么编译看起来一点问题都没有。只能用release模式调试，一步一步判断才发现这个问题。</p>
<p>附上对应release设置的图片:<img src="../images/xcode8/editschema.png" alt="Screen shot"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Swift3/">Swift3</a><a href="/tags/Xcode8/">Xcode8</a><a href="/tags/ios/">ios</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/11/07/Swift3踩坑记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/11/07/Swift3踩坑记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/13/IOS蓝牙打印/" title="ios蓝牙打印" itemprop="url">ios蓝牙打印</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  <p class="article-time">
    <time datetime="2016-06-13T00:55:05.000Z" itemprop="datePublished"> 发表于 2016-06-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>:近来公司有个ios调用蓝牙打印机打印小票的功能，网上资料也有，ESC/POS打印指令集也有，以前刚毕业有做过winform调用网络小票打印机的功能，指令集反正都是差不多的。只是攻略不是很详细，这里把详细步骤和遇到的问题以及解决方法详细的记录下，已供后来人参考。这里建议大家还是使用ESC/POS指令来实现打印功能，大多数给力的打印机厂商都会兼容这套指令。<br>闲话不多说，经验教程如下：</p>
<p><strong>ps</strong>:我使用的是swift开发</p>
<h1 id="蓝牙连接"><a href="#蓝牙连接" class="headerlink" title="蓝牙连接"></a>蓝牙连接</h1><blockquote>
<p>蓝牙框架引入</p>
</blockquote>
<p><code>import CoreBluetooth</code></p>
<blockquote>
<p>创建蓝牙管理类</p>
</blockquote>
<p><code>lazy var blueManager:CBCentralManager? = CBCentralManager(delegate: self, queue: dispatch_get_main_queue())</code></p>
<blockquote>
<p>扫描可连接蓝牙</p>
</blockquote>
<p><code>blueManager?.scanForPeripheralsWithServices(nil, options: [CBCentralManagerScanOptionAllowDuplicatesKey:true])</code></p>
<blockquote>
<p>蓝牙处理代理类</p>
</blockquote>
<p>蓝牙设置开关的代理</p>
<pre><code>func centralManagerDidUpdateState(central: CBCentralManager) {
    switch (central.state)
    {
    case CBCentralManagerState.PoweredOn:
        //当蓝牙打开时，自动扫描对应的外设
            blueManager?.scanForPeripheralsWithServices(nil, options: [CBCentralManagerScanOptionAllowDuplicatesKey:true])
        }
        break
    default:
        NSLog(&quot;Central Manager did change state&quot;)
        break;
    }
}
</code></pre><p>扫描监听代理，当扫描到蓝牙设备时，这里会接受到通知</p>
<pre><code>func centralManager(central: CBCentralManager, didDiscoverPeripheral peripheral: CBPeripheral, advertisementData: [String : AnyObject], RSSI: NSNumber) {
    let uuid = peripheral.identifier.UUIDString
            print(&quot;发现设备&quot;)
            print(uuid)
            print(peripheral.name, advertisementData)
    print(&quot;------------------------------------------&quot;)
    /**
    * 不包含服务功能
    */
    if advertisementData[&quot;kCBAdvDataServiceUUIDs&quot;] == nil {
        return
    }
    //这里是把扫描到的不同设备保存起来，devices是自己定义的一个蓝牙设备数组
    if devices.find({$0.peripheral?.identifier.UUIDString == uuid}) == -1 {
        let serviceID = (advertisementData[&quot;kCBAdvDataServiceUUIDs&quot;] as? (String,String))?.1 ?? &quot;&quot;
        devices.append(Device(name: peripheral.name ?? LS(&quot;unnamed&quot;), peripheral: peripheral, serviceUUID:serviceID)) //&quot;未命名&quot;
    }

}
</code></pre><p>从打印机数组里面确定需要选择的打印机 调用连接代码，弱水三千，取一瓢而饮之。</p>
<pre><code>func connectDevice(device:Device) {
    blueManager?.stopScan()
    currentDevice = device
    blueManager?.connectPeripheral(device.peripheral!, options: nil)
}
</code></pre><p>连接打印机后，系统继续调用代理，告诉你连接结果<br>顾名思义，连不上T0T</p>
<pre><code>func centralManager(central: CBCentralManager, didFailToConnectPeripheral peripheral: CBPeripheral, error: NSError?) {
    MessageShow.ShareInstance.errorMessage = error?.localizedFailureReason ?? &quot;&quot;
    printDelegate?.selectPrinter()
}
</code></pre><p>连上了~，~</p>
<pre><code>func centralManager(central: CBCentralManager, didConnectPeripheral peripheral: CBPeripheral) {
    noConnectedTimer?.invalidate()
    disConnectTimer?.invalidate()
    peripheral.delegate = self
    peripheral.discoverServices(nil)
}
</code></pre><p>这是分手(断开连接)后的通知</p>
<pre><code>func centralManager(central: CBCentralManager, didDisconnectPeripheral peripheral: CBPeripheral, error: NSError?) {
}
</code></pre><p>连接上peripheral后需要连接对应的服务才能算真正连上</p>
<pre><code>func peripheral(peripheral: CBPeripheral, didDiscoverServices error: NSError?) {
    if error != nil {
        MessageShow.ShareInstance.errorMessage = error?.localizedFailureReason ?? LS(&quot;notfindprintservice&quot;) //&quot;该设备找不到对应的打印服务&quot;
        return
    }
    for service in peripheral.services! {
        //正常打印机的打印服务就是这个uuid
        if service.UUID == CBUUID(string: &quot;E7810A71-73AE-499D-8C15-FAA9AEF0C3F2&quot;) {
            currentDevice?.service = service
            //是的，你没看错，连上服务还得再连所谓的特性
            peripheral.discoverCharacteristics(nil, forService: service)
        }
    }
    if currentDevice?.service == nil {
        MessageShow.ShareInstance.errorMessage = LS(&quot;notfindprintservice&quot;) //&quot;该设备找不到对应的打印服务&quot;
        currentDevice = nil
    }
}

连接characteristics(翻译：特性)

func peripheral(peripheral: CBPeripheral, didDiscoverCharacteristicsForService service: CBService, error: NSError?) {
    if error != nil {
        MessageShow.ShareInstance.errorMessage = error?.localizedFailureReason ?? LS(&quot;notfindprintservice&quot;) //&quot;该设备找不到对应的打印服务&quot;
        return
    }

    if service.characteristics != nil {
        for characteristic in service.characteristics! {
            if characteristic.UUID == CBUUID(string: &quot;BEF8D6C9-9C21-4C9E-B632-BD58C1009F9F&quot;) {
                currentDevice?.characteristic = characteristic
                peripheral.setNotifyValue(true, forCharacteristic: characteristic)
                //打印机连上了，后面就可以对他发指令打印了
                //printDelegate?.doPrintBill()
            }
        }
    }
}
</code></pre><p>再来个断开连接的代码<br><code>blueManager?.cancelPeripheralConnection(currentDevice!.peripheral!)</code></p>
<h1 id="打印机指令集"><a href="#打印机指令集" class="headerlink" title="打印机指令集"></a>打印机指令集</h1><p>再开始打印指令的教程前，免不得先说说遇到坑吧。</p>
<ol>
<li>ios对打印机的指令发送是必须要有长度限度的，不同打印机的长度不一样。当你发现打印一个长长的字符串发现打一半卡死时，就得考虑下长度截取的问题了。</li>
<li>大多数打印机没有交互功能，也就是只能对牛弹琴了。so断开打印机的时机也是个问题。当然一对一永远连接的就不用断开了。</li>
<li>打印条码，建议还是需要打印功能比较好的打印机。</li>
</ol>
<p>下面大致写下常用的打印指令：</p>
<blockquote>
<p>初始化打印机</p>
</blockquote>
<pre><code>func initPrint() {
    sendCode([0x1b, 0x40], boolEnd: true)
}
</code></pre><blockquote>
<p>打印字符串</p>
</blockquote>
<p>打印字符串的位置一般自己调吧，align表示这行（注意行，这个不能拆分）的打印靠左靠右</p>
<pre><code>func printText(text: String, align: NSTextAlignment) {
    self.align(align)
    //中文字符打印需要转码
    let encode =  CFStringConvertEncodingToNSStringEncoding(UInt32(CFStringEncoding(CFStringEncodings.GB_18030_2000.rawValue)))
    var printStr = text
    //兼容某些渣渣打印机设置长度限制，好点的打印机1000也没什么问题
    while printStr.charLength() &gt; 60 {
        let nowStr = printStr.substringToIndex(32)
        let tmpData = NSString(string: nowStr).dataUsingEncoding(encode, allowLossyConversion: false)!
        sendMsg(tmpData)
        printStr = printStr.substringFromIndex(32)
    }
    if printStr.characters.count &gt; 0 {
        let tmpData = NSString(string: printStr).dataUsingEncoding(encode, allowLossyConversion: false)!
        sendMsg(tmpData)
    }
}

/**
 text 对齐

 - parameter align: .
 */
func align(align:NSTextAlignment) -&gt; NSMutableData {
    if align == currentAlign {
        return NSMutableData()
    }
    currentAlign = align
    var bytes:[UInt8] = [0x1b, 0x61]
    switch align {
    case .Center:
        bytes.append(0x01)
    case .Right:
        bytes.append(0x02)
    default:
        bytes.append(0x00)
    }
    sendCode(bytes)
    return NSMutableData()
}

//加粗

func bold(enable:Bool) {
    var bytes:[UInt8] = [0x1b, 0x45]
    bytes.append(enable ? 0x01 : 0x00)
    sendCode(bytes)
}

//打开钱箱    

func openBox() {
    let bytes:[UInt8] = [27,112, 0, 200,200]
    sendCode(bytes)
}

/**
 结束走纸 最后表示走几行纸
 */
func endPrint() {
    sendCode([0x1b, 0x64, 0x05] as [UInt8])
    cutPaper()
}

/**
 切纸
 */
func cutPaper() {
    //半切01，全切00
    sendCode([0x1d, 0x56, 0x00] as [UInt8], boolEnd: true)
}
</code></pre><blockquote>
<p>   加载图片</p>
</blockquote>
<p>   图片方式 打印条码用的。这里用了ZXingObjC库转码，可以在打印的开头先预存图片，再打印，注意渣打印机是打印不了的，甚至会卡死打印机</p>
<pre><code>func loadImage(code:String) {
    let writer = ZXMultiFormatWriter()
    do {
        let result = try writer.encode(code, format: kBarcodeFormatCode128, width: 20, height: 44)
        let hehe = result.descriptionWithSetString(&quot;1&quot;, unsetString: &quot;0&quot;)
        let haha = hehe.componentsSeparatedByString(&quot;\n&quot;)[0]
        let x = haha.characters.count
        let y:UInt8 = 5
        //打印指令解释有点难理解，大致解释下，0x1d, 0x2a 为指令， x/8=条码长度/8 y:高度 适应条码宽度而已 &gt;1 即可 
        var barcodes:[UInt8] = [0x1D, 0x2A, UInt8(x / 8), y]
        for index in haha.characters.indices {
            if haha[index] == &quot;0&quot; {
                for _ in 0..&lt;y {
                    barcodes.append(0x00)
                }
            } else {
                for _ in 0..&lt;y {
                    barcodes.append(255)
                }
            }
        }
        //发送定义位图的指令
        sendCode(barcodes)
    } catch {
        print(error)
    }
}
</code></pre><blockquote>
<p> 打印预存的图片   </p>
</blockquote>
<pre><code>func printBarcode() {
    sendCode([0x1d, 0x2f, 0x03])
}
</code></pre><blockquote>
<p> 发送指令的代码</p>
</blockquote>
<pre><code>func sendCode(bytes:[UInt8], boolEnd:Bool = false) {
    let data = NSData(bytes: bytes, length: bytes.count)
    sendMsg(data, boolEnd: boolEnd)
}

func sendMsg(data:NSData, boolEnd:Bool = false) {
    print(data.length)
    peripheral?.writeValue(data, forCharacteristic: characteristic!, type: .WithoutResponse)
}
</code></pre><p><strong>ps</strong>：还有一种直接条码打印的方式，手里打印机有限，一个渣，另外一只居然不能接受条码指令，渣打印机打不出来，所以就不写出来了。大致就是获取字符串的unicode，在指令后一起传入。没有成功~，~如果有知道的也可以补充下。</p>
<p>最后推荐下指令集比较完整的文档：</p>
<p><a href="http://www.docin.com/p-676248934.html" target="_blank" rel="external"> http://www.docin.com/p-676248934.html </a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Bluetooth/">Bluetooth</a><a href="/tags/Swift/">Swift</a><a href="/tags/ios/">ios</a><a href="/tags/Print/">Print</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/13/IOS蓝牙打印/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/13/IOS蓝牙打印/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wesin" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/PM/" title="PM">PM<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ios/" title="ios">ios<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Swift3/" title="Swift3">Swift3<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Xcode8/" title="Xcode8">Xcode8<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Bluetooth/" title="Bluetooth">Bluetooth<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ios/" title="ios">ios<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Swift/" title="Swift">Swift<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Print/" title="Print">Print<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/UML/" title="UML">UML<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/PM/" title="PM">PM<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://www.github.com" target="_blank" title="Github">Github</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="undefined" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=c0177d78&dpc=1"></iframe>
    <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height=86 src="http://music.163.com/outchain/player?type=2&id=412902950&auto=1&height=66"></iframe> -->
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Wesin in Hunpun. <br/>
			风也如是,雨也如梦.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/he8706799" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/wesin" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Wesin">Wesin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
