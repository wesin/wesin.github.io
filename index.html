
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>Wesin&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Wesin">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Wesin&#39;s blog">
<meta property="og:url" content="http://wesin.github.io/index.html">
<meta property="og:site_name" content="Wesin&#39;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wesin&#39;s blog">

    
    
    <link rel="icon" href="/img/cat.ico">
    
    
    <link rel="apple-touch-icon" href="/img/bigcat.png">
    <link rel="apple-touch-icon-precomposed" href="/img/bigcat.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/bigcat.png" alt="Wesin&#39;s blog" title="Wesin&#39;s blog"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Wesin&#39;s blog">Wesin&#39;s blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索">
						<input type="hidden" name="q" value="site:wesin.github.io">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/04/09/Maxcompute批量分区删除/" title="Maxcompute批量分区删除" itemprop="url">Maxcompute批量分区删除</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2019-04-09T07:03:07.000Z" itemprop="datePublished"> 发表于 2019-04-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>: Maxcompute数据仓库建设的分享。</p>
<h1 id="Maxcompute"><a href="#Maxcompute" class="headerlink" title="Maxcompute"></a>Maxcompute</h1><p>大致介绍下Maxcompute, Maxcompute是阿里的一个大数据工具，基于Maxcompute阿里搭建了一个Datawork的数据平台。可以很“方便”的从各种数据源导入数据，做数据分析、机器学习等。</p>
<p>“方便”之所以加个引号，是因为某些方面的确很方便，<br>当然业务实在复杂了，很多时候也存在用的很难受的地方。</p>
<p>更多介绍去阿里官网了解吧。</p>
<p>回到正题，这里主要分享下批量删除分区的一个小技巧。</p>
<h1 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h1><p>介绍下分区的概念，Table是一个数据表，也是一个分区的数组。分区把Table的数据分成了一个个的区块。</p>
<p>Maxcompute是个不支持某条数据修改删除的数据仓库。而分区是可以删除和新增的。引入分区，就可以做到在小颗粒度上做到修改和删除的功能。</p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>首先描述下为何会有大量的分区需要删除的场景。</p>
<ul>
<li>数据从datahub归档，比如按频率最高的归档方式 15分钟一次，每次一个分区，可以想象几个月后将会有多少分区。</li>
<li>数据从mysql分库增量读取，以每天一次增量，乘以分库的数量，也会产生大量的分区。</li>
</ul>
<p>分区数量多了之后，文件将会变多。一个是Maxcompute对于表的分区是一个上限数量，另一个是分区数量多了之后计算将会很慢。</p>
<p>这些源数据将会经过清洗产生对应的中间表或者结果集，供BI或者数据分析使用。而源数据为了方便管理，可以通过sql聚合成一个大分区来存放。而原来的很多分区就可以删除，以便腾出空间。</p>
<h1 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h1><p>一般正常删除分区是通过sql来删除。</p>
<pre><code>alter table 表A drop if EXISTS PARTITION(分区名=&apos;123&apos;)
</code></pre><p>这种方式只能一次删除一个分区，当分区有上万个的时候就不适用了。</p>
<p>这种情况可以通过pyodps来轻松的批量删除分区。</p>
<p>下面是一个删除datahub归档分区的实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除历史分区，防止分区数达到上限</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, timedelta</span><br><span class="line"><span class="comment"># 删除十天前分区</span></span><br><span class="line">end_date = date.today() - timedelta(days=<span class="number">10</span>)</span><br><span class="line">end = end_date.strftime(<span class="string">'%Y%m%d'</span>)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drop_pars</span><span class="params">(tableName)</span>:</span></span><br><span class="line">    t = o.get_table(tableName)</span><br><span class="line">    s = list(filter(<span class="keyword">lambda</span> x: x.name &lt; <span class="string">"ds='&#123;&#125;'"</span>.format(end), t.partitions))</span><br><span class="line">    <span class="keyword">for</span> par <span class="keyword">in</span> s:</span><br><span class="line">        par.drop()</span><br><span class="line">	</span><br><span class="line">drop_pars(<span class="string">"dhub_trade"</span>)</span><br><span class="line">drop_pars(<span class="string">"dhub_ft_trade"</span>)</span><br><span class="line">drop_pars(<span class="string">"dhub_dn_trade"</span>)</span><br><span class="line">drop_pars(<span class="string">"dhub_wms_trade"</span>)</span><br><span class="line">drop_pars(<span class="string">"dhub_trade_send"</span>)</span><br><span class="line">drop_pars(<span class="string">"dhub_wms_trade_send"</span>)</span><br></pre></td></tr></table></figure>
<p>可以在dataworks里面新建个pyodps的节点来每天运行，一劳永逸。</p>
<p>如果是放在python本地运行的话建议使用ipython。具体还需要配置下odps的环境。可以参考下<a href="https://pyodps.readthedocs.io/zh_CN/latest/interactive.html#ipython" target="_blank" rel="noopener">官方文档</a>。</p>
<h1 id="后语"><a href="#后语" class="headerlink" title="后语"></a>后语</h1><p>Dataworks使用中分库分表很多，怎么配置大量的同步任务。有经验的可以一起研究下。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Maxcompute/">Maxcompute</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/04/09/Maxcompute批量分区删除/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/04/09/Maxcompute批量分区删除/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/04/09/Swift5踩坑记/" title="Swift5踩坑记" itemprop="url">Swift5踩坑记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2019-04-09T04:03:24.000Z" itemprop="datePublished"> 发表于 2019-04-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>: 春光如梭，一年又已过去，xcode10丝滑的过度了4.2版本。以为苹果终于给力了。然而xcode10.2的升级，Swift5的更新让我明白了一个道理，xcode10.2才是那个点，xcode10说不定只是老板催的急，临时发的一个版。</p>
<p>闲话不多说，描述下这次遇到的问题吧。</p>
<h1 id="HashValue-彻底不能用了"><a href="#HashValue-彻底不能用了" class="headerlink" title="HashValue 彻底不能用了"></a>HashValue 彻底不能用了</h1><p>其实这个swift4.2就已经有了新的方案，只是前面一直还能用。swift5直接编译报错了。</p>
<p>下面就是替换方案的使用方法。</p>
<pre><code>// swift 3
extension Point: Equatable{
    func ==(lhs: Testhash, rhs: Testhash) -&gt; Bool {
        return lhs.hashValue == rhs.hashValue
    }
}
extension Point: Equatable {
    var hashValue: Int {
        get {
            return self.x + self.y * self.x
        }
    }
}

// swift 4.2
extension Point: Equatable {
    static func ==(lhs: Point, rhs: Point) -&gt; Bool {
        // Ignore distanceFromOrigin for determining equality
        return lhs.x == rhs.x &amp;&amp; lhs.y == rhs.y
    }
}
extension Point: Hashable {
    func hash(into hasher: inout Hasher) {
        // Ignore distanceFromOrigin for hashing
        hasher.combine(x)
        hasher.combine(y)
    }
}
</code></pre><h1 id="大坑-release版本发布后TableView某些delegate无法触发生效"><a href="#大坑-release版本发布后TableView某些delegate无法触发生效" class="headerlink" title="大坑,release版本发布后TableView某些delegate无法触发生效"></a>大坑,release版本发布后TableView某些delegate无法触发生效</h1><p>具体描述下场景, 当TableView所创建的类没有实现某些可以不实现的代理，比如didselect， heightforrow。然后这个类被子类继承，实现了didselect、heightforheader、heightforfooter的方法。在debug模式下，代码运行很正常，点击事件，高度都能正常显示。但是打包发布后，从testflight下载过来，就有可能存在点击，tableview行焦点色会变化，但是事件没法触发的问题。或者header和footer高度不对的问题。</p>
<p>这个问题的原因估计是编译优化做了修改导致的。</p>
<p>最无脑的解决方案是在父类把这几个方法都写一个空的实现，子类做函数重写。亲测有效。</p>
<p>高端解决办法，可能需要去修改一些编译选项吧，然而没测试过，有大佬搞过的也可以指导下。</p>
<p>此问题是Xcode10.2的锅，与swift版本无关。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ios/">ios</a><a href="/tags/Swift5/">Swift5</a><a href="/tags/Xcode10-2/">Xcode10.2</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/04/09/Swift5踩坑记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/04/09/Swift5踩坑记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/10/11/Swift4踩坑记/" title="Swift4踩坑记" itemprop="url">Swift4踩坑记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2017-10-11T01:29:05.000Z" itemprop="datePublished"> 发表于 2017-10-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>: 时隔一年差一个月，xcode9也出来了，swift4也升级了。犹记得上次swift3代码升级的惊悚场景，这次心中默默打了个底，一定不能手贱，一定要在xcode9.1出来我再升级。然而终究抵不住心中的好奇升级了，升级，升级了……幸好，幸好，相比xcode8，xcode9真是良心了。犹记得xcode8.0出来我是等了一个月xcode8.1出来我才能发版的，等的感觉要被公司辞退了T.T。</p>
<p>忆苦思甜过后，细数下代码升级中遇到的坑吧。</p>
<h1 id="各种姿势的-objc-objcMembers"><a href="#各种姿势的-objc-objcMembers" class="headerlink" title="各种姿势的@objc @objcMembers"></a>各种姿势的@objc @objcMembers</h1><h2 id="objc"><a href="#objc" class="headerlink" title="@objc"></a>@objc</h2><p>swift4里面所有的<strong>#selector(action)</strong> <em>action</em>方法都要加上@objc标记，资料说是为了兼容object-c代码。代码里面<strong>#selector</strong>的普及率还是相当高的，一个个改的手残。</p>
<h2 id="objcMembers"><a href="#objcMembers" class="headerlink" title="@objcMembers"></a>@objcMembers</h2><p>swift4里面NSObject的取值方法value(forkey)方法会造成运行时崩溃，有很多对象copy用了反射的免不得都会崩溃。然而编译器不会提示你代码错了。这里简单点处理可以给class对象添加@objcMembers标记, 也可以给属性添加@objc dynamic，realm就这是这么做的，当然所有realm数据库对象也得要改造下</p>
<pre><code>@objcMembers
class StockDetailItem:NSObject {
    @objc dynamic var title = &quot;&quot;
    @objc dynamic var quantity = 0.0
    var actualNum = 0.0
    var fulllessNum = 0.0

    override init() {
        super.init()
    }

}

let item = StockDetailItem()
item.title = &quot;haha&quot;
item.value(forKey: &quot;title&quot;)
item.value(forKey: &quot;quantity&quot;)
</code></pre><p>这个代码修改也挺多，为了对象copy简便，自己写了个反射方法</p>
<h1 id="swift3遗留的tableview-delegate坑"><a href="#swift3遗留的tableview-delegate坑" class="headerlink" title="swift3遗留的tableview delegate坑"></a>swift3遗留的tableview delegate坑</h1><p>在swift3里面大部分代理函数名称都简化了，比如</p>
<pre><code>func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell
</code></pre><p>原来是</p>
<pre><code>func tableView(_ tableView: UITableView, cellForRowAtIndexPath indexPath: IndexPath) -&gt; UITableViewCell
</code></pre><p>问题是不是所有的代理方法都改造，还落了几个 didselect 和canedit 这几个方法还是老样子，swift4里面全简化了。然而也没有警告或者错误提示。</p>
<h1 id="扫描功能没反应了"><a href="#扫描功能没反应了" class="headerlink" title="扫描功能没反应了"></a>扫描功能没反应了</h1><p>切了swift4之后扫码全部失效了。一脸茫然，代码也没有任何错误提示。幸好stackoverflow上的有个解答，原来是代理方法名改了。</p>
<pre><code>func captureOutput(_ captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [Any]!, from connection: AVCaptureConnection!)
</code></pre><p>改成了</p>
<pre><code>func metadataOutput(_ output: AVCaptureMetadataOutput, didOutput metadataObjects: [AVMetadataObject], from connection: AVCaptureConnection)
</code></pre><h1 id="ipad上自定义UIBarButtonItem显示位置异常"><a href="#ipad上自定义UIBarButtonItem显示位置异常" class="headerlink" title="ipad上自定义UIBarButtonItem显示位置异常"></a>ipad上自定义UIBarButtonItem显示位置异常</h1><p>一般这种显示异常的按钮都是自定义的customview。使用正常的UIBarButtonItem是没问题的.</p>
<p>如果确定要使用CustomView，需要专门设置view的intrinsicContentSize, 也就是设置大小即可。<br>参考代码如下</p>
<ul>
<li><p>intrinsicContentSize是只读属性，需要继承后重写</p>
<pre><code>class CommonNavigationView: UIView {

    init(size: CGSize) {
        super.init(frame: CGRect(origin: CGPoint.zero, size: size))
        self.overrideSize = size
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError(&quot;init(coder:) has not been implemented&quot;)
    }

    lazy var overrideSize = CGSize.zero

    override var intrinsicContentSize: CGSize {
        get {
            return overrideSize
        }
    }
}
</code></pre></li>
</ul>
<ul>
<li><p>放上个UIBarButton的扩展，这里使用Cartography做约束</p>
<pre><code>import Cartography

extension UIBarButtonItem {
    enum Style {
        case left
        case right
    }

    convenience init(style: Style, customView: UIView, target:Any, action: Selector) {
        let backView = CommonNavigationView(size: CGSize(width: 44, height: 44))
        backView.addSubview(customView)
        let gesturer = UITapGestureRecognizer(target: target, action: action)
        backView.addGestureRecognizer(gesturer)
        constrain(customView) {
            imgv in
            if style == .left {
                imgv.left == imgv.superview!.left
            } else {
                imgv.right == imgv.superview!.right
            }
            imgv.centerY == imgv.superview!.centerY
            imgv.width == 25
            imgv.height == 25
        }
        self.init(customView: backView)
    }

    convenience init(style: Style, img: UIImage, target:Any, action: Selector) {
        let backView = CommonNavigationView(size: CGSize(width: 44, height: 44))
        let imgView = UIImageView(image: img)
        backView.addSubview(imgView)
        let gesturer = UITapGestureRecognizer(target: target, action: action)
        backView.addGestureRecognizer(gesturer)
        constrain(imgView) {
            imgv in
            if style == .left {
                imgv.left == imgv.superview!.left
            } else {
                imgv.right == imgv.superview!.right
            }
            imgv.centerY == imgv.superview!.centerY
            imgv.width == 25
            imgv.height == 25
        }
        self.init(customView: backView)
    }
}
</code></pre></li>
</ul>
<h1 id="UITableView-顶部莫名留白"><a href="#UITableView-顶部莫名留白" class="headerlink" title="UITableView 顶部莫名留白"></a>UITableView 顶部莫名留白</h1><p>网上还是挺多解释的，然而基本都不适用，研究了好久，关闭行高估算， 设置头部高度。两者缺一不可</p>
<pre><code>tableView.estimatedRowHeight = 0
tableView.estimatedSectionHeaderHeight = 0
tableView.estimatedSectionFooterHeight = 0

  func tableView(_ tableView: UITableView, heightForHeaderInSection section: Int) -&gt; CGFloat {
    return 0.1
}
</code></pre><p>就先这样吧，祝各位升级愉快！</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ios/">ios</a><a href="/tags/Swift4/">Swift4</a><a href="/tags/Xcode9/">Xcode9</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/10/11/Swift4踩坑记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/10/11/Swift4踩坑记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/18/Python学习-实战篇/" title="Python学习-实战篇" itemprop="url">Python学习-实战篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2017-08-18T08:03:42.000Z" itemprop="datePublished"> 发表于 2017-08-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Web自动化测试方案"><a href="#Web自动化测试方案" class="headerlink" title="Web自动化测试方案"></a>Web自动化测试方案</h1><p>Python selenium phantomJS</p>
<p><a href="http://cuiqingcai.com/2599.html" target="_blank" rel="noopener">http://cuiqingcai.com/2599.html</a></p>
<h1 id="运维自动化"><a href="#运维自动化" class="headerlink" title="运维自动化"></a>运维自动化</h1><p>使用 Fabric3 自动化部署 Python3 项目</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/18/Python学习-实战篇/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/18/Python学习-实战篇/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/14/敏捷开发被忽视的UML/" title="敏捷开发被忽视的UML" itemprop="url">敏捷开发被忽视的UML</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2017-08-14T03:19:09.000Z" itemprop="datePublished"> 发表于 2017-08-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>混了两年开发，忽然又进入了PM的角色上，好久没有做过项目管理了，很多工作方法都忘了。这里回忆顺便做个记录。</p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>从上次跳槽进了一个创业公司，一个20来个人的小公司，万事从简，交流靠吼，需求靠说。人少了还好，和产品1v1的干也没什么大不了。不得不说，公司发展很快，短短两年，公司已经有150+的人马了。团队也变大了，然而产品的需求还是几句话的描述，再多加几个界面图，交互，场景纯靠描述。几个产品的对接更是一群产品在讲天书，路人完全不知道讲的什么鬼。心理默默想，图呢。</p>
<h1 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h1><p>UML：Unified Modeling Language(统一建模语言)<br>UML主要的就是画图，图有好几种。<br>可以按照需求画相应的图。</p>
<p>这边着重介绍几个图：</p>
<ul>
<li>用例</li>
<li>活动图</li>
<li>类图</li>
<li>时序图</li>
<li>(流程图)</li>
</ul>
<h2 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h2><p>用例图：从用户角度描述系统功能，并指各功能的操作者。</p>
<p><img src="../images/UML/approcase.png" alt="Image"></p>
<h2 id="活动图"><a href="#活动图" class="headerlink" title="活动图"></a>活动图</h2><p>活动图是UML用于对系统的动态行为建模的另一种常用工具，它描述活动的顺序，展现从一个活动到另一个活动的控制流。活动图在本质上是一种流程图。</p>
<p>它是UML中用于对系统动态活动建模的图形，反映系统中一个活动到另一个活动的流程，常常用于描述业务过程和并行处理过程。活动图中包括泳道、活动开始、活动结束、活动、对象、分支、消息等图形符号。</p>
<p>总的来说：活动图是描述多个角色间协同工作的流程图。</p>
<p>用门店采购对接多牛供应商流程画了个事例图。<br><img src="../images/UML/pospurchaseduoniu.png" alt="Screen shot"></p>
<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p>流程图：流程图并不属于UML的基本图形类型，但是是程序员入门必须的一种图。可以拿来简单明朗的显示代码逻辑。</p>
<p>门店微信支付流程图。<br><img src="../images/UML/pospay.png" alt="Screen shot"></p>
<h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><p>类图：一般用于程序员与程序员之间的对话。作用于描述复杂的设计模式、框架、架构、类关系等<br><img src="../images/UML/class.png" alt="Image"></p>
<h2 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h2><p>时序图：比较清晰的描述函数的运行流程。</p>
<p><img src="../images/UML/time.png" alt="Image"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/PM/">PM</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/UML/">UML</a><a href="/tags/PM/">PM</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/14/敏捷开发被忽视的UML/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/14/敏捷开发被忽视的UML/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/12/Python学习-方法篇/" title="Python学习-方法篇" itemprop="url">Python学习-方法篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2017-08-12T03:04:28.000Z" itemprop="datePublished"> 发表于 2017-08-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="初始化篇"><a href="#初始化篇" class="headerlink" title="初始化篇"></a>初始化篇</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>mac本身自带了python版本，but是python2.x版本，如果有强迫症喜欢使用最新版本的可以安装python3。我这边安装在了/usr/local/bin,这个一般是在脚本文件第一行声明，表示使用python版本。</p>
<pre><code>#!/usr/local/bin/python3
</code></pre><h2 id="设置可执行的脚本权限"><a href="#设置可执行的脚本权限" class="headerlink" title="设置可执行的脚本权限"></a>设置可执行的脚本权限</h2><pre><code>chmod +x xxxx.py
</code></pre><h2 id="pip安装对应的python版本依赖库"><a href="#pip安装对应的python版本依赖库" class="headerlink" title="pip安装对应的python版本依赖库"></a>pip安装对应的python版本依赖库</h2><pre><code>sudo python3 -m pip install **
</code></pre><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>推荐：    Visual Studio Code </p>
<h1 id="语法学习"><a href="#语法学习" class="headerlink" title="语法学习"></a>语法学习</h1><p>随便挑几个语法python3语法网站学习<br><a href="http://www.web3.xin/python3/107.html" target="_blank" rel="noopener">http://www.web3.xin/python3/107.html</a><br><a href="http://www.runoob.com/python/python-pass-statement.html" target="_blank" rel="noopener">http://www.runoob.com/python/python-pass-statement.html</a></p>
<p>进阶可以阅读下<br><strong>Python进阶</strong>: <a href="https://github.com/eastlakeside/interpy-zh" target="_blank" rel="noopener">https://github.com/eastlakeside/interpy-zh</a></p>
<h1 id="方法篇"><a href="#方法篇" class="headerlink" title="方法篇"></a>方法篇</h1><p>使用过sublime和vscode来学习和编程python，对于语法的智能提示和高亮都挺差的，so相对于java、c#、swift这种语法严谨的语言来说，编写体验极差，对新手非常不友好，经常写着写着要去翻词典。</p>
<p>所以新手阶段免不得多练多写了。</p>
<h3 id="查看对象方法"><a href="#查看对象方法" class="headerlink" title="查看对象方法"></a>查看对象方法</h3><pre><code>&gt;&gt;&gt; a 
[1, 2, 3, 4, 4, 7]
&gt;&gt;&gt; dir(a)
[&apos;__add__&apos;, &apos;__class__&apos;, &apos;__contains__&apos;, &apos;__delattr__&apos;, &apos;__delitem__&apos;, &apos;__dir__&apos;, &apos;__doc__&apos;, &apos;__eq__&apos;, &apos;__format__&apos;, &apos;__ge__&apos;, &apos;__getattribute__&apos;, &apos;__getitem__&apos;, &apos;__gt__&apos;, &apos;__hash__&apos;, &apos;__iadd__&apos;, &apos;__imul__&apos;, &apos;__init__&apos;, &apos;__init_subclass__&apos;, &apos;__iter__&apos;, &apos;__le__&apos;, &apos;__len__&apos;, &apos;__lt__&apos;, &apos;__mul__&apos;, &apos;__ne__&apos;, &apos;__new__&apos;, &apos;__reduce__&apos;, &apos;__reduce_ex__&apos;, &apos;__repr__&apos;, &apos;__reversed__&apos;, &apos;__rmul__&apos;, &apos;__setattr__&apos;, &apos;__setitem__&apos;, &apos;__sizeof__&apos;, &apos;__str__&apos;, &apos;__subclasshook__&apos;, &apos;append&apos;, &apos;clear&apos;, &apos;copy&apos;, &apos;count&apos;, &apos;extend&apos;, &apos;index&apos;, &apos;insert&apos;, &apos;pop&apos;, &apos;remove&apos;, &apos;reverse&apos;, &apos;sort&apos;]
</code></pre><h3 id="查看方法使用"><a href="#查看方法使用" class="headerlink" title="查看方法使用"></a>查看方法使用</h3><pre><code>help(a)
</code></pre><p>也可以help某个方法</p>
<pre><code>help(a.count)
</code></pre><h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>例如 len(array)来获取列表长度这种，习惯了array.count无脑写法的，表示心累。</p>
<p><a href="http://www.runoob.com/python/python-built-in-functions.html" target="_blank" rel="noopener">http://www.runoob.com/python/python-built-in-functions.html</a></p>
<h1 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h1><p>定位脚本性能瓶颈</p>
<pre><code>python -m cProfile my_script.py
</code></pre><p>csv转json</p>
<pre><code>python -c &quot;import csv,json;print json.dumps(list(csv.reader(open(&apos;csv_file.csv&apos;))))
</code></pre><p>yield 接收输入</p>
<pre><code>def grep(pattern):
    print(&quot;Searching for&quot;, pattern)
    while True:
        line = (yield)
        if pattern in line:
            print(line)

search = grep(&apos;coroutine&apos;)
next(search)
#output: Searching for coroutine
search.send(&quot;I love you&quot;)
search.send(&quot;Don&apos;t you love me?&quot;)
search.send(&quot;I love coroutine instead!&quot;)
#output: I love coroutine instead!
</code></pre><p>读取文件数据</p>
<pre><code>import io

with open(&apos;photo.jpg&apos;, &apos;rb&apos;) as inf:
    jpgdata = inf.read()
</code></pre><ul>
<li>如果你想读取文件，传入r</li>
<li>如果你想读取并写入文件，传入r+</li>
<li>如果你想覆盖写入文件，传入w</li>
<li>如果你想在文件末尾附加内容，传入a</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>配置好环境，浏览下语法，掌握了方法，应该就可以开搞了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/12/Python学习-方法篇/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/12/Python学习-方法篇/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/12/Python学习-语法篇/" title="Python学习-语法篇" itemprop="url">Python学习-语法篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2017-08-12T03:03:50.000Z" itemprop="datePublished"> 发表于 2017-08-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><ul>
<li>万物皆是对象</li>
<li>属性就是对象的字典</li>
</ul>
<h2 id="引用类型和值类型"><a href="#引用类型和值类型" class="headerlink" title="引用类型和值类型"></a>引用类型和值类型</h2><ul>
<li><p>踩坑版之从Swift过来操作数组</p>
<pre><code>var a = [1, 2, 4]
var b = a
b += [9]
a
b
</code></pre></li>
</ul>
<ul>
<li><p>永远不要定义可变类型的参数    </p>
<pre><code>&gt;&gt;&gt; def add_to(num, target=[]):
...     target.append(num)
...     return target
... 
&gt;&gt;&gt; add_to(1)
[1]
&gt;&gt;&gt; add_to(2)
[1, 2]
</code></pre></li>
</ul>
<h2 id="内置函数之语法糖"><a href="#内置函数之语法糖" class="headerlink" title="内置函数之语法糖"></a>内置函数之语法糖</h2><ul>
<li><p>列表生成式</p>
<pre><code>[x for x in range(5) if x % 2 == 0]
</code></pre></li>
<li><p>map, filter, reduce</p>
<pre><code>list(map(lambda x:x*2, range(5)))
list(filter(lambda x:x &gt; 3, range(5)))
</code></pre></li>
<li><p>sorted</p>
<pre><code>&gt;&gt;&gt; L = [(&apos;Bob&apos;, 75), (&apos;Adam&apos;, 92), (&apos;Bart&apos;, 66), (&apos;Lisa&apos;, 88)]
&gt;&gt;&gt; def by_name(t):
...     return t[0].lower()
... 
&gt;&gt;&gt; l1 = sorted(L, key=by_name)
&gt;&gt;&gt; l1
[(&apos;Adam&apos;, 92), (&apos;Bart&apos;, 66), (&apos;Bob&apos;, 75), (&apos;Lisa&apos;, 88)]
</code></pre></li>
</ul>
<h2 id="踩坑pymysql"><a href="#踩坑pymysql" class="headerlink" title="踩坑pymysql"></a>踩坑pymysql</h2><ul>
<li>%d format: a number is required, not str</li>
</ul>
<p>报错sql语句:</p>
<pre><code>insert into sections(id, bookid, name, seq, url) values(&quot;%s&quot;, &quot;%s&quot;, &quot;%s&quot;,%d,&quot;%s&quot;)&apos;
</code></pre><p>正确sql语句:</p>
<pre><code>insert into sections(id, bookid, name, seq, url) values(&quot;%s&quot;, &quot;%s&quot;, &quot;%s&quot;,%s,&quot;%s&quot;)&apos;
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/12/Python学习-语法篇/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/12/Python学习-语法篇/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/01/18/IOS蓝牙外设使用兼AppStore审核记/" title="IOS蓝牙外设使用兼AppStore审核记" itemprop="url">IOS蓝牙外设使用兼AppStore审核记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2017-01-18T06:27:20.000Z" itemprop="datePublished"> 发表于 2017-01-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>:打印，又是打印，销售不知道哪里找来个打印机要支持。好吧，不是所有的蓝牙打印机都是可以用corebluetooth去连接的。这次是Bixolon，spp型号的打印机。网上一搜，是个韩国的打印机。中国连官方代理也没有，只有淘宝有个买家，自称代理。这种打印机用的是苹果MFI认证的连接方式。免不得要适配下，废话不多说，献上教程。</p>
<h1 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h1><blockquote>
<ul>
<li>Build Phases 中添加ExternalAccessory.framework</li>
<li>Capabilities<br>   1.启用background modes 勾选External accessory communication、 Uses Bluetooth LE accessories、Acts as a Bluetooth LE accessory<br>  2.启用Wireless Accessory Configuration</li>
<li>info.plist添加Supported external accessory protocols<br><img src="../images/xcode8/info-external.png" alt="Screen shot"></li>
</ul>
</blockquote>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>一般调用对应的sdk即可，用corebluetooth的寻找打印机是找不到的。</p>
<h1 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h1><blockquote>
<ul>
<li>手机or pad蓝牙设置中先连接打印机。一般要输pin码。bixolon的pin码默认是0000</li>
<li>连接好打印机后再去代码中调用sdk查找打印机，方能找到打印机。然后对应发指令即可。ps:网上有不需要sdk也可以连接打印机。没尝试过，代码略多</li>
</ul>
</blockquote>
<h1 id="App审核"><a href="#App审核" class="headerlink" title="App审核"></a>App审核</h1><p>很关键，使用MFI认证的连接方式是必须要从厂家获取PPID的。这个流程一般是这样的。跟厂家沟通，厂家一般会发你一个表格可以填，需要的内容app名称、版本号、bundleid等。然后厂家拿这个去苹果申请把bundleid添加到他们的ppid里面。然后把ppid告诉我们。我们放到itunes里面的remark中备注好即可。一般如果已经审核被拒绝了，放上去之后最好在拒绝后面回复下已经放入备注中，不然人家也不会注意看，分分钟又拒绝了。在下已然有这样的经历。<br>这里大致贴下拒绝信息：<br>—– MFi - PPID —–</p>
<p>We have started your app review but are unable to complete the review because we cannot locate the MFi Product Plan ID (PPID) of the hardware accessory associated with your app.</p>
<p>If you do not know the PPID, please contact the accessory manufacturer for this information. Once you have the PPID, please enter this information in the Notes section for your app in iTunes Connect.</p>
<p>To edit the Notes section:</p>
<ul>
<li>Log in to iTunes Connect</li>
<li>Click on “My Apps”</li>
<li>Select your app</li>
<li>Scroll down to “App Review Information”</li>
<li>Update “Notes”</li>
<li>Click Save</li>
<li>Click Submit for Review</li>
</ul>
<p>Once you’ve updated the Notes section with the PPID, we can proceed with your app review. </p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Swift3/">Swift3</a><a href="/tags/Xcode8/">Xcode8</a><a href="/tags/Bluetooth/">Bluetooth</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/01/18/IOS蓝牙外设使用兼AppStore审核记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/01/18/IOS蓝牙外设使用兼AppStore审核记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/11/07/Swift3踩坑记/" title="Swift3踩坑记" itemprop="url">Swift3踩坑记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2016-11-07T01:37:19.000Z" itemprop="datePublished"> 发表于 2016-11-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>:Xcode8出来两个星期，手贱忍不住升级了，抱着对swift3强烈的期望升级了，升级了，升级，升……然后雪崩一场。</p>
<h1 id="Xcode8打开永远崩溃"><a href="#Xcode8打开永远崩溃" class="headerlink" title="Xcode8打开永远崩溃"></a><strong>Xcode8打开永远崩溃</strong></h1><p>刚升级的xcode8每次打开输入第一个字符就崩溃，一直如此从来没有改变。错误信息显示imagenamed插件问题，菜单栏并没有插件显示，强行自我淡定了下，在xcode插件目录找到了残留的插件尸体。<br>~/Library/Application Support/Developer/Shared/Xcode/Plug-ins<br>删除后终于能正常打开了。</p>
<h1 id="编译卡住不动了"><a href="#编译卡住不动了" class="headerlink" title="编译卡住不动了"></a><strong>编译卡住不动了</strong></h1><p>好醉，说好的优化了性能呢，代码转换后各种错误，然后编译找错误提示，再编译再来一批，打完N波僵尸后，系统编译到某个文件卡住永远不动了，关键是也不报错。听着笔记本可怜的轰隆隆声，心好碎。</p>
<p>网上找了N多资料，终于发现蛛丝马迹。</p>
<p>网上有说再以前的版本，有遇到xml字符串太长造成编译卡住问题。<br>仔细研究代码发现，原来是一个fmdb的sql语句问题，字段太多，insert语句太长，然后xcode就卡住了，卡住了，卡住，了……一口老血。</p>
<p>解决方法，不能使用fmdb自带的update方法，因为赋值参数太多了，会卡住，所以只能拼装成一个完整的sql，然后把老长老长的sql用StringBuilder包装起来，分割成无数份。</p>
<p>好吧，终于编译通过了。</p>
<h1 id="Swift3优化不完整的代码bug"><a href="#Swift3优化不完整的代码bug" class="headerlink" title="Swift3优化不完整的代码bug"></a><strong>Swift3优化不完整的代码bug</strong></h1><p>UITableView在ios开发中使用频率应该是很高的，swift3对UITableView的几个代理方法做了写法上的优化，比如</p>
<pre><code>func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell
</code></pre><p>原来的写法cellForRowAt对应的是cellForRowAtIndexPath，少了多余的IndexPath，完美，看起来简化多了。批量替换下呗。</p>
<p>编译好后一看高度什么鬼，点击为什么没效果。然而编译也没报错。还原回去才发现 didSelectRowAtIndexPath 在xcode8中后面的IndexPath必须有，没有这个代理就不会被调用。也是吐血一升。</p>
<h1 id="Swift3-extension的坑"><a href="#Swift3-extension的坑" class="headerlink" title="Swift3 extension的坑"></a><strong>Swift3 extension的坑</strong></h1><p>我不知道extension文档里面有没有说过不能放override的方法，不然这个方法在release下面是不会被调用的。然而为什么在debug模式下override的方法又会被调用。这个只能说坑到家了。好不容易把代码打包半天提交到Itunesconnect, testflight下来一看剧情不一样。</p>
<p>🐱了个咪，为什么编译看起来一点问题都没有。只能用release模式调试，一步一步判断才发现这个问题。</p>
<p>附上对应release设置的图片:<img src="../images/xcode8/editschema.png" alt="Screen shot"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Swift3/">Swift3</a><a href="/tags/Xcode8/">Xcode8</a><a href="/tags/ios/">ios</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/11/07/Swift3踩坑记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/11/07/Swift3踩坑记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/13/IOS蓝牙打印/" title="ios蓝牙打印" itemprop="url">ios蓝牙打印</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Wesin" target="_blank" itemprop="author">Wesin</a>
		
  </p><p class="article-time">
    <time datetime="2016-06-13T00:55:05.000Z" itemprop="datePublished"> 发表于 2016-06-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>ps</strong>:近来公司有个ios调用蓝牙打印机打印小票的功能，网上资料也有，ESC/POS打印指令集也有，以前刚毕业有做过winform调用网络小票打印机的功能，指令集反正都是差不多的。只是攻略不是很详细，这里把详细步骤和遇到的问题以及解决方法详细的记录下，已供后来人参考。这里建议大家还是使用ESC/POS指令来实现打印功能，大多数给力的打印机厂商都会兼容这套指令。<br>闲话不多说，经验教程如下：</p>
<p><strong>ps</strong>:我使用的是swift开发</p>
<h1 id="蓝牙连接"><a href="#蓝牙连接" class="headerlink" title="蓝牙连接"></a>蓝牙连接</h1><blockquote>
<p>蓝牙框架引入</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CoreBluetooth</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建蓝牙管理类</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> blueManager:<span class="type">CBCentralManager?</span> = <span class="type">CBCentralManager</span>(delegate: <span class="keyword">self</span>, queue: dispatch_get_main_queue())</span><br></pre></td></tr></table></figure>
<blockquote>
<p>扫描可连接蓝牙</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blueManager?.scanForPeripheralsWithServices(<span class="literal">nil</span>, options: [<span class="type">CBCentralManagerScanOptionAllowDuplicatesKey</span>:<span class="literal">true</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>蓝牙处理代理类</p>
</blockquote>
<p>蓝牙设置开关的代理</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">centralManagerDidUpdateState</span><span class="params">(central: CBCentralManager)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (central.state)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">CBCentralManagerState</span>.<span class="type">PoweredOn</span>:</span><br><span class="line">        <span class="comment">//当蓝牙打开时，自动扫描对应的外设</span></span><br><span class="line">            blueManager?.scanForPeripheralsWithServices(<span class="literal">nil</span>, options: [<span class="type">CBCentralManagerScanOptionAllowDuplicatesKey</span>:<span class="literal">true</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="type">NSLog</span>(<span class="string">"Central Manager did change state"</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>扫描监听代理，当扫描到蓝牙设备时，这里会接受到通知</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(central: CBCentralManager, didDiscoverPeripheral peripheral: CBPeripheral, advertisementData: [String : AnyObject], RSSI: NSNumber)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> uuid = peripheral.identifier.<span class="type">UUIDString</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"发现设备"</span>)</span><br><span class="line">            <span class="built_in">print</span>(uuid)</span><br><span class="line">            <span class="built_in">print</span>(peripheral.name, advertisementData)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"------------------------------------------"</span>)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 不包含服务功能</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> advertisementData[<span class="string">"kCBAdvDataServiceUUIDs"</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这里是把扫描到的不同设备保存起来，devices是自己定义的一个蓝牙设备数组</span></span><br><span class="line">    <span class="keyword">if</span> devices.<span class="built_in">find</span>(&#123;$<span class="number">0</span>.peripheral?.identifier.<span class="type">UUIDString</span> == uuid&#125;) == -<span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> serviceID = (advertisementData[<span class="string">"kCBAdvDataServiceUUIDs"</span>] <span class="keyword">as</span>? (<span class="type">String</span>,<span class="type">String</span>))?.<span class="number">1</span> ?? <span class="string">""</span></span><br><span class="line">        devices.append(<span class="type">Device</span>(name: peripheral.name ?? <span class="type">LS</span>(<span class="string">"unnamed"</span>), peripheral: peripheral, serviceUUID:serviceID)) <span class="comment">//"未命名"</span></span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从打印机数组里面确定需要选择的打印机 调用连接代码，弱水三千，取一瓢而饮之。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectDevice</span><span class="params">(device:Device)</span></span> &#123;</span><br><span class="line">    blueManager?.stopScan()</span><br><span class="line">    currentDevice = device</span><br><span class="line">    blueManager?.connectPeripheral(device.peripheral!, options: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>连接打印机后，系统继续调用代理，告诉你连接结果<br>顾名思义，连不上T0T</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(central: CBCentralManager, didFailToConnectPeripheral peripheral: CBPeripheral, error: NSError?)</span></span> &#123;</span><br><span class="line">    <span class="type">MessageShow</span>.<span class="type">ShareInstance</span>.errorMessage = error?.localizedFailureReason ?? <span class="string">""</span></span><br><span class="line">    printDelegate?.selectPrinter()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>连上了~，~</p>
<pre><code>func centralManager(central: CBCentralManager, didConnectPeripheral peripheral: CBPeripheral) {
    noConnectedTimer?.invalidate()
    disConnectTimer?.invalidate()
    peripheral.delegate = self
    peripheral.discoverServices(nil)
}
</code></pre><p>这是分手(断开连接)后的通知</p>
<pre><code>func centralManager(central: CBCentralManager, didDisconnectPeripheral peripheral: CBPeripheral, error: NSError?) {
}
</code></pre><p>连接上peripheral后需要连接对应的服务才能算真正连上</p>
<pre><code>func peripheral(peripheral: CBPeripheral, didDiscoverServices error: NSError?) {
    if error != nil {
        MessageShow.ShareInstance.errorMessage = error?.localizedFailureReason ?? LS(&quot;notfindprintservice&quot;) //&quot;该设备找不到对应的打印服务&quot;
        return
    }
    for service in peripheral.services! {
        //正常打印机的打印服务就是这个uuid
        if service.UUID == CBUUID(string: &quot;E7810A71-73AE-499D-8C15-FAA9AEF0C3F2&quot;) {
            currentDevice?.service = service
            //是的，你没看错，连上服务还得再连所谓的特性
            peripheral.discoverCharacteristics(nil, forService: service)
        }
    }
    if currentDevice?.service == nil {
        MessageShow.ShareInstance.errorMessage = LS(&quot;notfindprintservice&quot;) //&quot;该设备找不到对应的打印服务&quot;
        currentDevice = nil
    }
}

连接characteristics(翻译：特性)

func peripheral(peripheral: CBPeripheral, didDiscoverCharacteristicsForService service: CBService, error: NSError?) {
    if error != nil {
        MessageShow.ShareInstance.errorMessage = error?.localizedFailureReason ?? LS(&quot;notfindprintservice&quot;) //&quot;该设备找不到对应的打印服务&quot;
        return
    }

    if service.characteristics != nil {
        for characteristic in service.characteristics! {
            if characteristic.UUID == CBUUID(string: &quot;BEF8D6C9-9C21-4C9E-B632-BD58C1009F9F&quot;) {
                currentDevice?.characteristic = characteristic
                peripheral.setNotifyValue(true, forCharacteristic: characteristic)
                //打印机连上了，后面就可以对他发指令打印了
                //printDelegate?.doPrintBill()
            }
        }
    }
}
</code></pre><p>再来个断开连接的代码<br><code>blueManager?.cancelPeripheralConnection(currentDevice!.peripheral!)</code></p>
<h1 id="打印机指令集"><a href="#打印机指令集" class="headerlink" title="打印机指令集"></a>打印机指令集</h1><p>再开始打印指令的教程前，免不得先说说遇到坑吧。</p>
<ol>
<li>ios对打印机的指令发送是必须要有长度限度的，不同打印机的长度不一样。当你发现打印一个长长的字符串发现打一半卡死时，就得考虑下长度截取的问题了。</li>
<li>大多数打印机没有交互功能，也就是只能对牛弹琴了。so断开打印机的时机也是个问题。当然一对一永远连接的就不用断开了。</li>
<li>打印条码，建议还是需要打印功能比较好的打印机。</li>
</ol>
<p>下面大致写下常用的打印指令：</p>
<blockquote>
<p>初始化打印机</p>
</blockquote>
<pre><code>func initPrint() {
    sendCode([0x1b, 0x40], boolEnd: true)
}
</code></pre><blockquote>
<p>打印字符串</p>
</blockquote>
<p>打印字符串的位置一般自己调吧，align表示这行（注意行，这个不能拆分）的打印靠左靠右</p>
<pre><code>func printText(text: String, align: NSTextAlignment) {
    self.align(align)
    //中文字符打印需要转码
    let encode =  CFStringConvertEncodingToNSStringEncoding(UInt32(CFStringEncoding(CFStringEncodings.GB_18030_2000.rawValue)))
    var printStr = text
    //兼容某些渣渣打印机设置长度限制，好点的打印机1000也没什么问题
    while printStr.charLength() &gt; 60 {
        let nowStr = printStr.substringToIndex(32)
        let tmpData = NSString(string: nowStr).dataUsingEncoding(encode, allowLossyConversion: false)!
        sendMsg(tmpData)
        printStr = printStr.substringFromIndex(32)
    }
    if printStr.characters.count &gt; 0 {
        let tmpData = NSString(string: printStr).dataUsingEncoding(encode, allowLossyConversion: false)!
        sendMsg(tmpData)
    }
}

/**
 text 对齐

 - parameter align: .
 */
func align(align:NSTextAlignment) -&gt; NSMutableData {
    if align == currentAlign {
        return NSMutableData()
    }
    currentAlign = align
    var bytes:[UInt8] = [0x1b, 0x61]
    switch align {
    case .Center:
        bytes.append(0x01)
    case .Right:
        bytes.append(0x02)
    default:
        bytes.append(0x00)
    }
    sendCode(bytes)
    return NSMutableData()
}

//加粗

func bold(enable:Bool) {
    var bytes:[UInt8] = [0x1b, 0x45]
    bytes.append(enable ? 0x01 : 0x00)
    sendCode(bytes)
}

//打开钱箱    

func openBox() {
    let bytes:[UInt8] = [27,112, 0, 200,200]
    sendCode(bytes)
}

/**
 结束走纸 最后表示走几行纸
 */
func endPrint() {
    sendCode([0x1b, 0x64, 0x05] as [UInt8])
    cutPaper()
}

/**
 切纸
 */
func cutPaper() {
    //半切01，全切00
    sendCode([0x1d, 0x56, 0x00] as [UInt8], boolEnd: true)
}
</code></pre><blockquote>
<p>   打印图片</p>
</blockquote>
<p>图片需要做点阵转换，这个代码太多，给个搬砖地址。<a href="https://github.com/Haley-Wong/HLBluetoothDemo" target="_blank" rel="noopener">HLBluetoothDemo</a><br>，这里有点要注意下，改github的代码并不能在佳博打印机上打印二维码或者图片。主要是因为佳博打印机每次发送指令的最大长度只有146.而示例都是把指令全部组装好了一起发送，会导致打印机断片。</p>
<p>所以下面的代码就是把图片指令拆分长度来发送给打印机</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">printImg</span><span class="params">(<span class="number">_</span> image: UIImage, width: CGFloat)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> borderImg = image.decorateBorder(<span class="number">10</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> img = borderImg.blackAndWhite()?.imageWithscaleMaxWidth(width) &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> data = img.bitmapData() &#123;</span><br><span class="line">                log.ln(<span class="string">"qrcode size: "</span> + data.<span class="built_in">count</span>.description)/</span><br><span class="line">                <span class="keyword">var</span> curIndex = <span class="number">0</span></span><br><span class="line">                <span class="keyword">let</span> step = <span class="number">100</span></span><br><span class="line">                <span class="keyword">while</span>(curIndex &lt; data.<span class="built_in">count</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> endIndex = curIndex + step &lt; data.<span class="built_in">count</span> ? curIndex + step : data.<span class="built_in">count</span></span><br><span class="line">                    <span class="keyword">let</span> tmpData = data.subdata(<span class="keyword">in</span>: curIndex..&lt;endIndex)</span><br><span class="line">                    peripheral?.writeValue(tmpData, <span class="keyword">for</span>: characteristic!, type: .withoutResponse)</span><br><span class="line">                    curIndex += step</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        printNewLine()</span><br><span class="line"><span class="comment">//        // 恢复行间距</span></span><br><span class="line">        sendCode([<span class="number">0x1b</span>, <span class="number">0x32</span>], boolEnd: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>  上面代码里面有个<strong><em>image.decorateBorder</em></strong>，这是因为指令拆分后不知道为什么图片打印最下面几行总会有缺失，无法找到原因，所以做了个特别的处理，先给图片加了个外框。那么缺失的就是边框了，不影响图片整体打印。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extension UIImage &#123;</span><br><span class="line">    func decorateBorder(_ borderWidth: CGFloat) -&gt; UIImage? &#123;</span><br><span class="line">        let resultSize = CGSize(width: self.size.width + 2 * borderWidth, height: self.size.height + 2 * borderWidth)</span><br><span class="line">        UIGraphicsBeginImageContext(resultSize)</span><br><span class="line">        let borderPath = UIBezierPath(roundedRect: CGRect(origin: CGPoint(x: 0, y: 0), size: resultSize), cornerRadius: 0)</span><br><span class="line">        UIColor.white.setFill()</span><br><span class="line">        borderPath.fill()</span><br><span class="line">        let imgRect = CGRect(x: borderWidth, y: borderWidth, width: self.size.width, height: self.size.height)</span><br><span class="line">        self.draw(in: imgRect)</span><br><span class="line">        let resultImg = UIGraphicsGetImageFromCurrentImageContext()</span><br><span class="line">        UIGraphicsEndImageContext()</span><br><span class="line">        return resultImg</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  之所以要用<strong><em>imageWithscaleMaxWidth</em></strong>，是因为二维码太宽导致图片大小太大，超出了打印机的缓存空间，会导致图片打印不出来。</p>
<p>最后推荐下指令集比较完整的文档：</p>
<p><a href="http://www.docin.com/p-676248934.html" target="_blank" rel="noopener"> http://www.docin.com/p-676248934.html </a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Bluetooth/">Bluetooth</a><a href="/tags/Swift/">Swift</a><a href="/tags/ios/">ios</a><a href="/tags/Print/">Print</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/13/IOS蓝牙打印/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/13/IOS蓝牙打印/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wesin" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Maxcompute/" title="Maxcompute">Maxcompute<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/PM/" title="PM">PM<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ios/" title="ios">ios<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/ios/" title="ios">ios<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Swift3/" title="Swift3">Swift3<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Xcode8/" title="Xcode8">Xcode8<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Bluetooth/" title="Bluetooth">Bluetooth<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Swift/" title="Swift">Swift<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Print/" title="Print">Print<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Swift4/" title="Swift4">Swift4<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Xcode9/" title="Xcode9">Xcode9<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Swift5/" title="Swift5">Swift5<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Xcode10-2/" title="Xcode10.2">Xcode10.2<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/UML/" title="UML">UML<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/PM/" title="PM">PM<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://www.github.com" target="_blank" title="Github">Github</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="undefined" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=c0177d78&dpc=1"></iframe>
    <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height=86 src="http://music.163.com/outchain/player?type=2&id=412902950&auto=1&height=66"></iframe> -->
</div>


</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Wesin in Hunpun. <br>
			风也如是,雨也如梦.</p>
	</section>
	 
	<div class="social-font">
		
		<a href="http://weibo.com/he8706799" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/wesin" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Wesin">Wesin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
